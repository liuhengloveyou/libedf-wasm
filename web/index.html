<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
  <title>libedf</title>
</head>

<body>
  <input id="files" type="file" onchange="handleFileSelect" />
  <button id="read" onclick="onread">read</button>
  <button id="label" onclick="onReadLabel">label</button>
</body>
</body>

<script type='text/javascript'>
  const worker = new Worker("libedf.js")
  worker.addEventListener('message', e => {
    console.log("worker.message: ", e);
  });

  worker.postMessage("message from main.")

  function handleFileSelect(event) {
    let { files } = event.target;
    if (files.length != 1) {
      return;
    }

    console.log(">>>>>>>>>>>>>>", files)

    worker.postMessage({
      type: "open",
      file: files[0],
    })
  }

  function onread(event) {
    worker.postMessage({
      type: "read",
    })
  }

  function onReadLabel(event) {
    worker.postMessage({
      type: "read_label",
    })

  }

  document.querySelector("#files").addEventListener("change", handleFileSelect, false);
  document.querySelector("#read").addEventListener("click", onread, false);
  document.querySelector("#label").addEventListener("click", onReadLabel, false);

  window.onerror = function () {
    console.log("onerror: " + event);
  };


</script>

</html>